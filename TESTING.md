# Инструкции по тестированию

## Проверка инфраструктуры

### 1. Запуск системы

```bash
# Сборка и запуск всех контейнеров
docker-compose up -d --build
```

Ожидаемый результат:
- Контейнер `autosalon_db` запущен
- Контейнер `autosalon_app` запущен
- Нет ошибок в логах

### 2. Проверка подключения к базе данных

```bash
# Проверить логи приложения
docker logs autosalon_app | grep "подключение"
```

Ожидаемый вывод:
```
Успешное подключение к БД: db : 5432
Таблица cars успешно создана/проверена
Индексы успешно созданы/проверены
```

### 3. Проверка структуры базы данных

```bash
# Подключиться к PostgreSQL
docker exec -it autosalon_db psql -U user -d autosalon

# Выполнить SQL команды:
\dt                          # Показать таблицы
\d cars                      # Показать структуру таблицы cars
\di                          # Показать индексы
SELECT * FROM cars;          # Показать все записи
\q                           # Выйти
```

Ожидаемый результат:
- Таблица `cars` существует
- Поля: id, brand, manufacturer, release_date, mileage, price
- Constraints: CHECK (mileage >= 0), CHECK (price > 0)
- Индексы: idx_cars_brand, idx_cars_manufacturer, idx_cars_price

### 4. Доступ к GUI через браузер

1. Откройте браузер
2. Перейдите по адресу: `http://localhost:6080`
3. Дождитесь загрузки графического окружения
4. Приложение AutoSalon должно автоматически запуститься

Ожидаемый результат:
- Видно окно приложения "Автосалон - Курсовая работа"
- Таблица с колонками: Марка, Производитель, Дата выпуска, Пробег, Цена
- 7 кнопок управления внизу окна

### 5. Проверка переменных окружения

```bash
# Проверить переменные окружения в контейнере
docker exec autosalon_app env | grep DB_
```

Ожидаемый вывод:
```
DB_HOST=db
DB_PORT=5432
DB_NAME=autosalon
DB_USER=user
DB_PASSWORD=pass
```

## Тестирование функциональности

### Тест 1: Добавление записи

1. Нажмите кнопку "Добавить автомобиль"
2. Заполните форму:
   - Марка: Camry
   - Производитель: Toyota
   - Дата выпуска: 2020-01-15
   - Пробег: 50000
   - Цена: 1500000
3. Нажмите OK

**Ожидаемый результат:**
- Сообщение "Автомобиль добавлен"
- Новая запись появилась в таблице

### Тест 2: Валидация данных

1. Нажмите "Добавить автомобиль"
2. Оставьте поля пустыми или введите некорректные данные
3. Нажмите OK

**Ожидаемый результат:**
- Сообщение об ошибке "Некорректные данные!"
- Запись не добавлена

### Тест 3: Фильтрация по цене

1. Добавьте несколько записей с разными ценами
2. Нажмите "Фильтр по цене"
3. Введите максимальную цену (например, 2000000)

**Ожидаемый результат:**
- Открывается окно с отфильтрованными записями
- Показаны только автомобили с ценой <= 2000000

### Тест 4: Экспорт и чтение файла

1. Нажмите "Сформировать файл"
2. Проверьте сообщение об успехе
3. Нажмите "Показать файл"

**Ожидаемый результат:**
- Файл export.txt создан
- Содержимое файла отображается в окне
- Формат: brand;mileage;price

### Тест 5: Обновление цены

1. Нажмите "Изменить цену"
2. Введите марку (например, Camry)
3. Введите новую цену (например, 1600000)

**Ожидаемый результат:**
- Сообщение "Цена обновлена"
- Цена изменилась в таблице для всех Camry

### Тест 6: Удаление по производителю

1. Нажмите "Удалить по производителю"
2. Введите производителя (например, Toyota)

**Ожидаемый результат:**
- Сообщение "Записи удалены"
- Все записи Toyota удалены из таблицы

### Тест 7: Обновление таблицы

1. Нажмите "Обновить таблицу"

**Ожидаемый результат:**
- Таблица перезагружается
- Показаны актуальные данные из БД

## Проверка персистентности данных

```bash
# Остановить контейнеры
docker-compose down

# Запустить снова
docker-compose up -d

# Открыть приложение в браузере
```

**Ожидаемый результат:**
- Все ранее добавленные записи сохранились
- База данных не потеряла данные

## Проверка производительности

### Тест индексов

```bash
# Подключиться к БД
docker exec -it autosalon_db psql -U user -d autosalon

# Проверить использование индексов
EXPLAIN ANALYZE SELECT * FROM cars WHERE brand = 'Camry';
EXPLAIN ANALYZE SELECT * FROM cars WHERE manufacturer = 'Toyota';
EXPLAIN ANALYZE SELECT * FROM cars WHERE price <= 2000000;
```

**Ожидаемый результат:**
- В плане выполнения видно использование индексов (Index Scan)
- Быстрое выполнение запросов

## Устранение проблем

### Проблема: Приложение не запускается

```bash
# Проверить логи
docker logs autosalon_app

# Перезапустить контейнер
docker-compose restart app
```

### Проблема: Не удается подключиться к БД

```bash
# Проверить, что БД запущена
docker-compose ps

# Проверить логи БД
docker logs autosalon_db

# Проверить сеть
docker network inspect autosalon_default
```

### Проблема: GUI не отображается в браузере

1. Подождите 10-15 секунд после запуска контейнера
2. Обновите страницу в браузере (F5)
3. Проверьте, что порт 6080 не занят другим приложением
4. Попробуйте другой браузер

## Контрольный список для защиты

- [ ] Система запускается командой `docker-compose up -d --build`
- [ ] GUI доступен через браузер на `http://localhost:6080`
- [ ] Таблица cars создана с правильными constraints
- [ ] Индексы созданы для оптимизации
- [ ] Можно добавить новую запись
- [ ] Валидация отклоняет некорректные данные
- [ ] Фильтрация по цене работает
- [ ] Экспорт в файл работает
- [ ] Чтение файла работает
- [ ] Обновление цены работает
- [ ] Удаление по производителю работает
- [ ] Данные сохраняются после перезапуска
- [ ] Все операции выполняются быстро (< 2 сек)
